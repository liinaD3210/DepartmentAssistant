# DepartmentAssistant

**DepartmentAssistant** — это многофункциональный ИИ-ассистент, предназначенный для интеграции в корпоративные чаты (например, Telegram). Его основная цель — автоматизация рутинных рабочих процессов, управление задачами и встречами, а также предоставление быстрого доступа к базе знаний компании.

Проект построен на асинхронном стеке Python и использует современные LLM-модели для понимания естественного языка, что позволяет пользователям взаимодействовать с системой в свободной форме, а не только через строгие команды.

## Ключевые возможности

-   **Интеллектуальная база знаний (Smart FAQ):**
    -   Поиск ответов на вопросы пользователей на основе семантической близости, а не только по ключевым словам.
    -   Генерация связных ответов (RAG) на основе найденной в базе информации, с указанием источников.
    -   Возможность пополнения базы знаний путем загрузки документов (`.txt`, `.docx`, `.pdf`).

-   **Трекер задач (Task Tracker):**
    -   Создание задач из сообщений в свободной форме (например, "Нужно подготовить отчет к пятнице @user").
    -   Извлечение названия задачи, дедлайна и ответственных с помощью LLM.
    -   Управление задачами через команды: просмотр активных (`/tasks`) и закрытие (`/close <id>`).
    -   Автоматические напоминания о предстоящих дедлайнах.

-   **Планировщик встреч (Meeting Scheduler):**
    -   Распознавание намерений о создании встречи из сообщений.
    -   Извлечение темы, даты и времени встречи.
    -   Интерактивное подтверждение создания встречи через inline-кнопки.
    -   Автоматические напоминания перед началом встречи.

-   **LLM-роутер:**
    -   Центральный компонент, который классифицирует каждое сообщение пользователя и направляет его в соответствующий модуль (FAQ, Задачи, Встречи), что обеспечивает гибкость и расширяемость системы.

-   **Ежедневные сводки (в разработке):**
    -   Функционал для автоматической генерации кратких итогов дня на основе переписки в чате.

## Технологический стек

-   **Язык:** Python 3.11+
-   **Основной фреймворк (Telegram Bot):** Aiogram 3
-   **Веб-демонстрация:** Streamlit
-   **Взаимодействие с LLM:** Google Gemini API (Flash/Pro)
-   **База данных:** PostgreSQL 15
-   **Векторный поиск:** Расширение `pgvector` для PostgreSQL
-   **Объектное хранилище:** MinIO (S3-совместимое)
-   **ORM и миграции:** SQLAlchemy 2.0 (async), Alembic
-   **Планировщик задач:** APScheduler
-   **Оркестрация:** Docker, Docker Compose

## Архитектура проекта

Проект следует принципам чистой архитектуры с разделением ответственности:

-   `src/bot/`: Код, отвечающий за взаимодействие с Telegram API (хендлеры, клавиатуры).
-   `src/services/`: Бизнес-логика приложения, не зависящая от конкретного мессенджера (LLM-роутер, парсеры, управление задачами).
-   `src/storage/`: Модули для работы с хранилищами данных (PostgreSQL, MinIO).
-   `src/core/`: Ядро приложения (настройки, общие модели Pydantic, исключения).
-   `src/scheduler/`: Логика для фоновых и отложенных задач.

## Установка и запуск

### Предварительные требования

-   Docker и Docker Compose
-   Python 3.11+ и `pip` (для запуска скрипта наполнения БД)
-   API-ключ для Google Gemini

### Порядок запуска

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://your-repository-url/DepartmentAssistant.git
    cd DepartmentAssistant
    ```

2.  **Создайте файл конфигурации:**
    Скопируйте `.env.example` в `.env` и заполните необходимые переменные:
    ```bash
    cp .env.example .env
    ```
    Обязательно укажите ваш `BOT_TOKEN` и `GEMINI_API_KEY`.

3.  **Установите локальные зависимости (опционально, для `seed_db.py`):**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Запустите сервисы с помощью Docker Compose:**
    Эта команда соберет образы и запустит все необходимые контейнеры (Telegram-бот, веб-демо, PostgreSQL, MinIO) в фоновом режиме.
    ```bash
    docker-compose up --build -d
    ```

5.  **Наполните базу данных демонстрационными данными:**
    Для корректной работы демо-версии необходимо один раз выполнить скрипт наполнения.
    ```bash
    python seed_db.py
    ```
    *Альтернативный способ (через Docker):*
    ```bash
    docker-compose exec demo python seed_db.py
    ```

### Доступ к сервисам

-   **Telegram-бот:** Найдите вашего бота в Telegram и начните с ним взаимодействовать.
-   **Веб-демонстрация:** Откройте в браузере `http://localhost:8501`.
-   **MinIO Console:** `http://localhost:9001` (логин/пароль из вашего `.env` файла).
-   **PostgreSQL:** Доступен на `localhost:5432` для подключения через любой SQL-клиент.

## Дальнейшее развитие

Проект имеет значительный потенциал для расширения:

-   Реализация модуля контроля договоров с парсингом дат и напоминаниями.
-   Разработка модуля для обработки HR и финансовых заявок.
-   Интеграция с внешними системами (Jira, Google Calendar) через API.
-   Дообучение (fine-tuning) собственной LLM-модели для повышения точности классификации и извлечения сущностей.
-   Переход на более производительные векторные индексы (HNSW) в `pgvector` при росте базы знаний.
